# Audio Echo Generation using Convolution

## Project Description
This project implements a real-time audio echo effect generator using convolution on the STM32F407G-DISC1 development board. It processes WAV files from a USB drive, applies a configurable echo effect using DSP techniques, and outputs the processed audio through the onboard CS43L22 audio codec to headphones or speakers.

Key features:
- Real-time convolution-based echo generation
- Adjustable echo delay and decay parameters
- USB mass storage support for WAV file playback
- Hardware-accelerated audio processing using DMA
- Interactive controls for play/pause/stop and echo enable/disable

## Hardware Requirements
- STM32F407G-DISC1 development board
- USB flash drive with WAV audio files
- Headphones or speakers (connected to the board's audio output)
- Micro-USB cable for power and programming

## Software Requirements
- STM32CubeIDE or other ARM development environment
- STM32CubeF4 HAL libraries
- FATFS middleware (for USB mass storage support)

## Installation & Usage
1. Clone this repository
2. Open the project in STM32CubeIDE
3. Build and flash to your STM32F407G-DISC1 board
4. Connect a USB flash drive with WAV files to the board's USB OTG port
5. Press the user button (PA0) to start playback of the default audio file
6. Use GPIO PA2 to toggle echo effect on/off
7. The ADC input can be used to control echo decay factor

## Key Components
### Main Files:
- `main.c` - System initialization and main control loop
- `wav_player.c` - WAV file handling and echo processing
- `audioI2S.c` - I2S audio interface driver
- `CS43L22.c` - Audio codec driver

### Key Functions:
- `applyEcho()` - Convolution-based echo generation
- `wavPlayer_process()` - Audio buffer management
- `audioI2S_play()` - I2S audio streaming
- `CS43L22_SetVolume()` - Audio output control

## Theory of Operation
The echo effect is generated by convolving the audio signal with an impulse response that models a single echo:

\[ h[n] = \delta[n] + \alpha\delta[n - D] \]

Where:
- \(\alpha\) is the echo decay factor (0.8 by default)
- \(D\) is the echo delay in samples (48000 samples â‰ˆ 1 second at 48kHz)

The implementation uses a circular buffer to store delayed samples and applies the convolution in real-time as the audio plays.

## Results
The system successfully produces clear echo effects with:
- Adjustable delay up to 1 second
- Configurable decay factor
- Real-time processing without audible artifacts
- Support for standard WAV formats (16-bit PCM, 8-48kHz)
